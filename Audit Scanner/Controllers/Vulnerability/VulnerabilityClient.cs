using System.Collections.Generic;
using Newtonsoft.Json;
using RestSharp;
using SaltwaterTaffy.Container;

namespace Audit_Scanner.Controllers.Vulnerability
{
    public class VulnerabilityClient
    {

        private const string _APIKEY = "cucp3O302CEzMWwJ87HA40y8q5f5GDS3";
        
        public List<Host> ScanVulnerabilities(List<Host> devices)
        {
            RestClient restClient = new RestClient("https://exploits.shodan.io/");
            RestRequest restRequest = new RestRequest("api/search", Method.GET);
            restRequest.AddParameter("key", _APIKEY);

            foreach (var device in devices)
            {
                foreach (var port in device.Ports)
                {
                    restRequest.AddParameter("query", $"{port.Service.Product} {port.Service.Version}");
                    var results = JsonConvert.DeserializeObject(restClient.Execute((IRestRequest) restRequest).Content);
                    var test = results;
                }
            }
            
            return devices;
        }
    }
}